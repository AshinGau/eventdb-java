<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title> 事例数据库EventDB - 面向高能物理的大数据管理系统</title>
    <script src="/static/js/jquery-3.2.1.min.js"></script>
    <script src="/static/js/echarts.common.min.js"></script>
</head>
<body>
<script>
    $(function () {
		var fitsChart = echarts.init(document.getElementById('chartShow'));
        var $timeStart = $("#timeStart"),
            $timeEnd = $("#timeEnd"),
            $detID = $("#detID"),
            $channel = $("#channel"),
            $pulse = $("#pulse"),
            $eventType = $("#eventType");
		var option = {
			title: {
				text: 'fits high energy distribution diagram'
			},
			tooltip : {
				trigger: 'axis',
				axisPointer: {
					type: 'cross',
					label: {
						backgroundColor: '#6a7985'
					}
				}
			},
			legend: {
				data:['detID','channel','pulseWidth','eventType']
			},
			dataZoom: [
				{   // 这个dataZoom组件，默认控制x轴。
					type: 'slider', // 这个 dataZoom 组件是 slider 型 dataZoom 组件
					start: 10,      // 左边在 10% 的位置。
					end: 40         // 右边在 60% 的位置。
				},
				{   // 这个dataZoom组件，也控制x轴。
					type: 'inside', // 这个 dataZoom 组件是 inside 型 dataZoom 组件
					start: 10,      // 左边在 10% 的位置。
					end: 40         // 右边在 60% 的位置。
				}
			],
			toolbox: {
				feature: {
					saveAsImage: {}
				}
			},
			grid: {
				left: '3%',
				right: '4%',
				bottom: '3%',
				containLabel: true
			},
			xAxis : [
				{
					type : 'category',
					boundaryGap : false,
					axisLabel: {
						formatter: function(value, idx) {
							var dts = value.split(" ");
							return idx == 0? value: dts[dts.length - 1];
						}
					}
					// data: []
				}
			],
			yAxis : [
				{
					type : 'value'
				}
			],
			series : [
				{
					name:'detID',
					type:'line',
					areaStyle: {normal: {}},
					// data: []
				},
				{
					name:'channel',
					type:'line',
					areaStyle: {normal: {}},
				},
				{
					name:'pulseWidth',
					type:'line',
					areaStyle: {normal: {}},
				},
				{
					name:'eventType',
					type:'line',
					areaStyle: {normal: {}},
				}
			]
		}; 
        $("#fitsSearch").click(function () {
            var query = "time=" + $timeStart.val() + "~" + $timeEnd.val()
                + "&detID=" + $detID.val()
                + "&channel=" + $channel.val()
                + "&pulse=" + $pulse.val()
                + "&eventType=" + $eventType.val();
			query = query.replace(/\s+/g,"");
            $.ajax({
                url: "/he/HeFits?" + query,
                type: "GET",
                dataType: "text",
                success: function (data) {
                   	var time = [],
						detID = [],
						channel = [],
						pulse = [],
						eventType = [];
					var lines = data.split("\n");
					var length = lines.length;
					var zoomend = 100 / length * 30;
					zoomend = zoomend < 10? 10: zoomend;
					zoomend = zoomend > 90? 50: zoomend;
					zoomend += 10;
					option.dataZoom[0].end = zoomend;
					option.dataZoom[1].end = zoomend;
					for(var i = 1; i < length; i++){
						var cols = lines[i].split(",");
						var dt = new Date((+ cols[0] + 1325376000) * 1000);
						time.push(dt.getFullYear()+"/"+(dt.getMonth()+1)+"/"+dt.getDate()+" "+dt.getHours()+":"+dt.getMinutes()+":"+dt.getSeconds());
						detID.push(+cols[1]);
						channel.push(+cols[2]);
						pulse.push(+cols[3]);
						eventType.push(+cols[4]);
					}
					option.xAxis[0].data = time;
					option.series[0].data = detID;
					option.series[1].data = channel;
					option.series[2].data = pulse;
					option.series[3].data = eventType;
					fitsChart.setOption(option);
                }
            })
        })
    })
</script>
<div class="container">
    <div class="row">
        <span>time:</span>
        <input type="text" id="timeStart" name="timeStart" value="178797000"/>
        <span>-</span>
        <input type="text" id="timeEnd" name="timeEnd" value="178797005"/>
        <span>detID:</span>
        <input type="text" id="detID" name="detID" value="1, 7"/>
        <span>channel:</span>
        <input type="text" id="channel" name="channel" value="12 ~ 20"/>
        <span>pulse:</span>
        <input type="text" id="pulse" name="pulse" value="0 ~ 255"/>
        <span>eventType:</span>
        <input type="text" id="eventType" name="eventType" value="0 ~ 255"/>
        <button type="button" id="fitsSearch">search</button>
    </div>
    <div class="row">
        <div class="chart">
            <div id="chartShow" style="width: 1200px; height: 742px;"></div>
        </div>
    </div>
</div>
<div class="footer">
    <p>© 2017<a href="">xjtuosv.com</a> XJTU OSV EventDBb</p>
</div>
</body>

</html>
